---
title: nginxéƒ¨ç½²å¤šä¸ªå‰ç«¯é¡¹ç›®
date: 2023-06-29 10:57:50
tags:
  - nginx
  - å‰ç«¯
categories: nginx
description: é€šè¿‡è®¿é—®ä¸åŒçš„å­è·¯å¾„éƒ¨ç½²å¤šä¸ªå‰ç«¯é¡¹ç›®ï¼Œå¹¶ç»“åˆ`vue-router`çš„ä¸åŒè·¯ç”±æ¨¡å¼ï¼Œç»™å‡ºä¸åŒçš„é…ç½®ã€‚
---
> å‰ç«¯é‡‡ç”¨vueæ¡†æ¶ï¼Œä¸»è¦ä»‹ç»åœ¨åŒä¸€ä¸ª`ip+port`ä¸‹ï¼ˆæˆ–åŸŸåï¼‰ï¼Œé€šè¿‡è®¿é—®ä¸åŒçš„**å­è·¯å¾„**éƒ¨ç½²å¤šä¸ªé¡¹ç›®

æŠŠå‰ç«¯æ‰“åŒ…å¥½çš„é¡¹ç›®ç›´æ¥æ”¾è¿› `nginx/html` ç›®å½•ä¸‹é¢ï¼Œ

![](https://files.mdnice.com/user/34064/b05479c5-8e4f-432f-bf6a-c9cb8e2cd650.png)

# è·¯ç”±é‡‡ç”¨hashæ¨¡å¼

æµè§ˆå™¨è®¿é—®çš„æ—¶å€™åœ¨urlåé¢æ‹¼æ¥ä¸Šè¦è®¿é—®çš„é¡¹ç›®å­è·¯å¾„å³å¯ï¼Œä¼šç”±`vue-router`æ¥ç®¡è·¯ç”±ï¼ˆhashæ¨¡å¼ï¼‰ï¼Œåé¢çš„è·¯å¾„è·³è½¬ã€èµ„æºè®¿é—®çš„æ“ä½œä¹Ÿéƒ½ä¼šåœ¨å­è·¯å¾„ä¸‹å¤„ç†ï¼Œnginxé…ç½®å¾ˆç®€å•ã€‚

`nginx/nginx.conf` æ–‡ä»¶çš„éƒ¨åˆ†é…ç½®å¦‚ä¸‹ï¼š

```
server {
        listen        80;
        server_name   www.axample.com;
        #rewrite      ^ https://$server_name$request_uri permanent;
        #charset koi8-r;

        #access_log  logs/host.access.log  main;
        # åœ¨443ç«¯å£é…ç½®é‡Œè®¾ç½®
        location / {
             root html;
             index index.html index.htm;
             try_files $uri $uri/ /index.html; # uriç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦
        }
}
```

**æµè§ˆå™¨è®¿é—®ï¼š**

- `https://www.axample.com/lily/` -> `https://www.axample.com/lily/#/home`
- `https://www.axample.com/mimosa/` -> `https://www.axample.com/mimosa/#/home`

# è·¯ç”±é‡‡ç”¨çš„éƒ½æ˜¯historyæ¨¡å¼

ä¸åŒäº hashæ¨¡å¼ï¼ŒHistory æ¨¡å¼éœ€è¦æœåŠ¡å™¨çš„æ”¯æŒï¼Œè¿˜æ˜¯é€šè¿‡è®¿é—®ä¸åŒçš„å­è·¯å¾„éƒ¨ç½²å¤šä¸ªé¡¹ç›®ï¼Œå½“æµè§ˆå™¨è®¿é—®é¡¹ç›®çš„æ—¶å€™ï¼Œä¼šæŠŠå­è·¯å¾„å¸¦ä¸Šå»è¯·æ±‚èµ„æºï¼Œå­˜åœ¨æ‰¾ä¸åˆ°èµ„æºçš„æƒ…å†µï¼Œæ‰€ä»¥éœ€è¦åœ¨åº”ç”¨è·¯å¾„å’Œnginxé…ç½®ä¸Šåšä¿®æ”¹ã€‚

## 1ã€router.jsè®¾ç½®

```
new Router({
  mode: 'history',
  base: '/mimosa/',
  routes,
});
```

`base` æ˜¯åº”ç”¨çš„åŸºè·¯å¾„ï¼Œé»˜è®¤å€¼: "/"ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæ•´ä¸ªå•é¡µåº”ç”¨æœåŠ¡åœ¨ `/app/` ä¸‹ï¼Œç„¶å `base` å°±åº”è¯¥è®¾ä¸º `/app/`ã€‚

## 2ã€vue.config.jsä¿®æ”¹publicPath

> å¦‚æœåªä¿®æ”¹äº†routerçš„è®¾ç½®ï¼Œæ²¡æœ‰ä¿®æ”¹`publicPath`ï¼Œæµè§ˆå™¨åœ°å€æ é”®å…¥ `https://www.axample.com/lily/` é¦–æ¬¡è¿›å…¥ç”±äº`vue-router`è®¾ç½®çš„ `redirect` ä¼šé‡å®šå‘åˆ°é¦–é¡µåœ°å€ï¼Œæ­£å¸¸æ˜¾ç¤ºç½‘é¡µï¼Œä½†æ˜¯å†æ¬¡åˆ·æ–°çš„æ—¶å€™ï¼Œæµè§ˆå™¨è¯·æ±‚çš„æ˜¯é‡å®šå‘è¿‡åçš„åœ°å€ï¼Œé™æ€æ–‡ä»¶åœ°å€æŒ‡å‘é”™ä¹±ï¼Œ`404`ä¸€èˆ¬æ¥è¯´å°±æ˜¯é…ç½®å’ŒçœŸå®çš„è·¯å¾„ä¸ç¬¦åˆï¼Œéœ€è¦æŒ‡å®š`try_files`


```
publicPath: IS_PROD ? '/lily/' : '/',  // å…¬å…±è·¯å¾„
```

**publicPathç”¨æ³•ï¼š**

`publicPath`: éƒ¨ç½²åº”ç”¨åŒ…æ—¶çš„åŸºæœ¬ URLï¼Œç”¨æ³•å’Œ `webpack` æœ¬èº«çš„ `output.publicPath` ä¸€è‡´ï¼Œ

ä½†æ˜¯ `Vue CLI` åœ¨ä¸€äº›å…¶ä»–åœ°æ–¹ä¹Ÿéœ€è¦ç”¨åˆ°è¿™ä¸ªå€¼ï¼Œæ‰€ä»¥ä¸ºäº†ä¿æŒç»Ÿä¸€ï¼Œç›´æ¥ä¿®æ”¹ `publicPath` è€Œä¸è¦ç›´æ¥ä¿®æ”¹ `webpack` çš„ `output.publicPath`ã€‚

1. é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Vue CLI` ä¼šå‡è®¾ä½ çš„åº”ç”¨æ˜¯è¢«éƒ¨ç½²åœ¨ä¸€ä¸ª**åŸŸåçš„æ ¹è·¯å¾„**ä¸Šï¼Œ

ä¾‹å¦‚ `https://www.my-app.com/`ã€‚

2. å¦‚æœåº”ç”¨è¢«éƒ¨ç½²åœ¨ä¸€ä¸ª**å­è·¯å¾„**ä¸Šï¼Œä½ å°±éœ€è¦ç”¨è¿™ä¸ªé€‰é¡¹æŒ‡å®šè¿™ä¸ªå­è·¯å¾„ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„åº”ç”¨è¢«éƒ¨ç½²åœ¨ `https://www.my-app.com/my-app/`ï¼Œåˆ™è®¾ç½® `publicPath` ä¸º `/my-app/`ã€‚

## 3ã€nginxè®¾ç½®

å¢åŠ å­åº”ç”¨çš„é…ç½®

```nginx
# 443ç«¯å£é…ç½®

location / {
  root html;
  index index.html index.htm;
  try_files $uri $uri/ /index.html;
}
location /lily {
  #alias /usr/local/nginx/html/lily/;#æŠŠåŒ¹é…åˆ°çš„è·¯å¾„é‡å†™, æ³¨æ„è¦ä»¥/ç»“å°¾
  root /usr/local/nginx/html; #åœ¨åŒ¹é…åˆ°çš„è·¯å¾„å‰é¢ï¼Œå¢åŠ rootåŸºç¡€è·¯å¾„é…ç½®
  try_files $uri $uri/ /lily/index.html; # ç‰¹å®šç›®å½•ï¼ŒåŒ¹é…ä¸åˆ°æ–‡ä»¶çš„è¯ï¼Œå¢åŠ /lily/index.htmlé…ç½®
  index index.html index.htm;
}
location /mimosa {
  #alias /usr/local/nginx/html/mimosa/;
  root /usr/local/nginx/html;
  try_files $uri $uri/ /mimosa/index.html;
  index index.html index.htm;
}
```

**æµè§ˆå™¨è®¿é—®:**
- `https://www.axample.com/lily/`
- `https://www.axample.com/mimosa/`

# å°ç»“

ä¸Šé¢è®²è§£äº†é€šè¿‡è®¿é—®ä¸åŒçš„å­è·¯å¾„éƒ¨ç½²å¤šä¸ªå‰ç«¯é¡¹ç›®ï¼Œå¹¶ç»“åˆ`vue-router`çš„ä¸åŒè·¯ç”±æ¨¡å¼ï¼Œç»™å‡ºä¸åŒçš„é…ç½®ã€‚

nginxæ–¹é¢çš„é…ç½®æ˜¯å†™åœ¨åŒä¸€ä¸ª `server` å—ä¸‹çš„ï¼Œé€šè¿‡ `location` å»åˆ†å‘ã€‚

ä¹Ÿå¯ä»¥é€šè¿‡**åŸŸå+ç«¯å£**çš„é…ç½®ï¼Œå®ç°éƒ¨ç½²å¤šä¸ªå‰ç«¯é¡¹ç›®ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æ·»åŠ ä¸åŒçš„`server` å—é…ç½®äº†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªå·±å°è¯•ä¸€ä¸‹ğŸ

---

æˆ‘æ˜¯ **ç”œç‚¹cc**ï¼Œä¸ªäººç½‘ç«™: [https://blog.i-xiao.space/](https://blog.i-xiao.space/)

åšäººåšäº‹åœ¨äºæ‰¬é•¿è€Œä¸æ˜¯è¡¥çŸ­

å…¬ä¼—å·ï¼šã€çœ‹è§å¦ä¸€ç§å¯èƒ½ã€‘
